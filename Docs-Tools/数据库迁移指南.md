
## ⚠️ 后续开发注意事项

### 1. 修改实体结构时（重要！）

每次修改 `Domain/Entities` 中的实体类后，**务必**生成迁移：

```bash
# 示例：添加新字段后
dotnet ef migrations add AddNewFieldToPost --project NamBlog.API
```

**为什么这很重要？**
- 当前配置忽略了"模型变更警告"
- 如果不生成迁移，启动时不会报错（警告被忽略）
- 但运行时访问新字段会报错：列不存在

### 2. 测试新迁移的兼容性

生成迁移后，测试两个数据库：

```bash
# 测试 SQLite
# 修改 config.json: DatabaseProvider → "SQLite"
dotnet run --project NamBlog.API

# 测试 PostgreSQL
# 修改 config.json: DatabaseProvider → "PostgreSQL"
dotnet run --project NamBlog.API
```

### 3. 代码审查清单

提交涉及实体变更的 Pull Request 时，检查：
- [ ] 是否修改了 `Domain/Entities/*.cs`？
- [ ] 是否生成了对应的迁移文件？
- [ ] 迁移文件是否包含 `Up` 和 `Down` 方法？
- [ ] 是否测试了两个数据库？

### 4. CI/CD 建议

在构建流程中添加检查：

```yaml
# GitHub Actions 示例
- name: 检查迁移状态
  run: |
    dotnet ef migrations list --project NamBlog.API
    # 确保没有 Pending 状态的迁移
```

### 5. 不要手动修改迁移文件

**错误做法**：
```csharp
// ❌ 不要手动修改 Migrations/*.cs
migrationBuilder.AddColumn<string>("NewField", ...);
```

**正确做法**：
```bash
# ✅ 修改实体后重新生成迁移
dotnet ef migrations remove --project NamBlog.API
dotnet ef migrations add CorrectMigration --project NamBlog.API
```

### 6. 生产部署前的验证

```bash
# 1. 检查迁移文件
git diff --name-only HEAD~1 | grep Migrations

# 2. 在测试环境验证
dotnet run --environment Staging

# 3. 检查日志
# 确认没有 "PendingModelChangesWarning" 之外的警告
```
