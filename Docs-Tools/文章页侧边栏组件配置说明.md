# 文章页侧边栏自定义组件配置说明

> 中文版本 | [English Version](Article-Sidebar-Widget-Configuration.md)

## 功能介绍

NamBlog 支持在文章页导航栏（右侧折叠式面板）的分类列表下方添加自定义 HTML 内容，用于显示二维码、广告、相关链接等个性化组件。

## 应用场景

- � 第三方评论组件（Giscus、Utterances 等）
- �💰 赞赏/打赏二维码
- 📱 微信公众号关注卡片
- 📧 邮件订阅入口
- 🔗 友情链接
- 📺 广告位（支持 iframe）
- 🎨 任何自定义 HTML 内容

## 配置方式

### 方式一：配置文件（推荐）

在 `data/config/config.json` 中添加 `ArticleSidebarWidget` 字段：

```json
{
  "Blog": {
    "BlogName": "我的博客",
    "Blogger": "博主",
    "ArticleSidebarWidget": "<div style='text-align:center; padding:12px; background:#f9fafb; border-radius:8px;'><h4 style='font-size:14px; margin:0 0 8px; color:#374151;'>❤️ 赞赏支持</h4><img src='/images/donate-qrcode.png' style='width:120px; height:120px; border-radius:4px;' /><p style='font-size:12px; color:#6b7280; margin:8px 0 0;'>感谢您的支持</p></div>"
  }
}
```

### 方式二：环境变量（Docker 部署）

在 Docker Compose 或容器启动时设置环境变量：

```yaml
# docker-compose.yml
services:
  namblog:
    environment:
      - Blog__ArticleSidebarWidget=<div style='text-align:center;'>...</div>
```

或命令行：

```bash
docker run -e 'Blog__ArticleSidebarWidget=<div>...</div>' ...
```

## 配置示例

> 💡 **深色模式提示**：以下所有样例都使用相对透明度或系统会自动适配的颜色，能够很好地适应深色/浅色主题切换。

### 1. 简单图片二维码

```json
{
  "ArticleSidebarWidget": "<img src='/images/qrcode.png' style='width:120px; display:block; margin:0 auto;' />"
}
```

### 2. 带标题的赞赏卡片（深色模式友好）

```json
{
  "ArticleSidebarWidget": "<div style='text-align:center; padding:16px; background:rgba(243,244,246,0.5); border-radius:8px;'><h4 style='font-size:14px; font-weight:600; margin:0 0 12px;'>❤️ 赞赏支持</h4><img src='/images/donate.png' style='width:100px; height:100px; border-radius:4px; margin:0 auto;' /><p style='font-size:12px; opacity:0.7; margin:8px 0 0;'>如果文章对您有帮助<br>欢迎扫码赞赏</p></div>"
}
```

### 3. 微信公众号关注

```json
{
  "ArticleSidebarWidget": "<div style='text-align:center; padding:14px; background:rgba(243,244,246,0.3); border:1px solid rgba(229,231,235,0.5); border-radius:8px; box-shadow:0 1px 3px rgba(0,0,0,0.05);'><h4 style='font-size:13px; font-weight:600; margin:0 0 10px;'>📱 关注公众号</h4><img src='/images/wechat-official.png' style='width:100px; height:100px; border-radius:4px; margin:0 auto 8px;' /><p style='font-size:11px; opacity:0.6; margin:0; line-height:1.5;'>获取最新技术文章推送</p></div>"
}
```

### 4. 多个推荐链接（相关阅读）

```json
{
  "ArticleSidebarWidget": "<div style='padding:14px; background:rgba(243,244,246,0.4); border-radius:8px;'><h4 style='font-size:13px; font-weight:600; margin:0 0 10px; border-bottom:2px solid currentColor; padding-bottom:6px; opacity:0.9;'>📚 推荐阅读</h4><a href='/article/vue-tutorial' style='display:block; padding:8px 0; text-decoration:none; font-size:13px; border-bottom:1px solid rgba(229,231,235,0.5); opacity:0.85;'>→ Vue 3 入门教程</a><a href='/article/react-hooks' style='display:block; padding:8px 0; text-decoration:none; font-size:13px; border-bottom:1px solid rgba(229,231,235,0.5); opacity:0.85;'>→ React Hooks 详解</a><a href='/article/typescript-guide' style='display:block; padding:8px 0; text-decoration:none; font-size:13px; opacity:0.85;'>→ TypeScript 实战指南</a></div>"
}
```

### 5. 使用模板变量（动态显示文章信息）

```json
{
  "ArticleSidebarWidget": "<div style='padding:12px; background:rgba(254,243,199,0.3); border-left:3px solid rgba(245,158,11,0.6); border-radius:4px;'><p style='font-size:12px; margin:0 0 6px; font-weight:600; opacity:0.8;'>📖 正在阅读</p><p style='font-size:13px; margin:0; font-weight:500; opacity:0.9;'>{{articleTitle}}</p><a href='/donate?article={{articleSlug}}' style='display:inline-block; margin-top:8px; padding:4px 12px; background:rgba(245,158,11,0.2); border-radius:4px; font-size:11px; text-decoration:none; opacity:0.85;'>支持本文</a></div>"
}
```

### 6. 双二维码（微信+支付宝）

```json
{
  "ArticleSidebarWidget": "<div style='text-align:center; padding:14px; background:rgba(249,250,251,0.5); border-radius:8px;'><h4 style='font-size:13px; font-weight:600; margin:0 0 10px;'>💰 赞赏码</h4><div style='display:flex; gap:10px; justify-content:center;'><div><img src='/images/wechat-pay.png' style='width:80px; height:80px; border-radius:4px;' /><p style='font-size:11px; opacity:0.7; margin:4px 0 0;'>微信</p></div><div><img src='/images/alipay.png' style='width:80px; height:80px; border-radius:4px;' /><p style='font-size:11px; opacity:0.7; margin:4px 0 0;'>支付宝</p></div></div></div>"
}
```

### 7. 邮件订阅入口

```json
{
  "ArticleSidebarWidget": "<div style='padding:14px; background:rgba(236,253,245,0.4); border:1px solid rgba(16,185,129,0.3); border-radius:8px;'><h4 style='font-size:13px; font-weight:600; margin:0 0 8px; opacity:0.9;'>📧 订阅更新</h4><p style='font-size:12px; margin:0 0 10px; line-height:1.5; opacity:0.8;'>每周收到最新技术文章推送</p><a href='mailto:subscribe@example.com?subject=订阅博客' style='display:block; text-align:center; padding:8px; background:rgba(16,185,129,0.2); border-radius:4px; font-size:12px; font-weight:500; text-decoration:none; opacity:0.9;'>立即订阅</a></div>"
}
```

### 8. 广告位（iframe）

```json
{
  "ArticleSidebarWidget": "<iframe src='https://ad-service.com/widget' style='width:100%; height:250px; border:0; display:block; border-radius:8px;'></iframe>"
}
```

### 9. 第三方评论组件（Giscus - GitHub Discussions）

```json
{
  "ArticleSidebarWidget": "<div style='padding:12px; background:rgba(243,244,246,0.4); border-radius:8px;'><h4 style='font-size:13px; font-weight:600; margin:0 0 10px; opacity:0.9;'>💬 文章评论</h4><p style='font-size:12px; opacity:0.7; margin:0 0 8px; line-height:1.5;'>欢迎在 GitHub Discussions 中讨论此文章</p><a href='https://github.com/your-repo/discussions' target='_blank' style='display:block; text-align:center; padding:8px; background:rgba(37,99,235,0.1); border-radius:4px; font-size:12px; text-decoration:none; opacity:0.85;'>👉 去评论</a></div>"
}
```

### 10. 评论组件（Utterances - 使用模板变量）

```json
{
  "ArticleSidebarWidget": "<div style='padding:12px; background:rgba(243,244,246,0.4); border-radius:8px;'><h4 style='font-size:13px; font-weight:600; margin:0 0 8px; opacity:0.9;'>💬 评论区</h4><p style='font-size:12px; opacity:0.7; margin:0 0 8px;'>对《{{articleTitle}}》有什么想法？</p><a href='https://github.com/your-repo/issues?q=is:issue+{{articleSlug}}' target='_blank' style='display:block; text-align:center; padding:8px; background:rgba(16,185,129,0.1); border-radius:4px; font-size:12px; text-decoration:none; opacity:0.85;'>参与讨论</a></div>"
}
```

## 模板变量支持（可选）

配置中可以使用文章元数据变量，在渲染时会自动替换：

- `{{articleTitle}}` - 文章标题
- `{{articleSlug}}` - 文章 slug
- `{{articleId}}` - 文章 ID

**示例：**

```json
{
  "ArticleSidebarWidget": "<div style='padding:12px;'><p style='font-size:12px; color:#6b7280;'>正在阅读：<strong>{{articleTitle}}</strong></p><a href='/donate?article={{articleSlug}}' style='color:#2563eb;'>支持本文</a></div>"
}
```

## 样式建议

由于自定义组件位于 Shadow DOM 中，**必须使用内联样式**才能正确显示。

### ✅ 推荐的样式写法（深色模式友好）

**使用透明度和 rgba 颜色**：
```html
<div style="padding:12px; background:rgba(243,244,246,0.5); border-radius:8px;">
  <h4 style="font-size:14px; margin:0 0 8px; opacity:0.9;">标题</h4>
  <img src="/image.png" style="width:120px; display:block; margin:0 auto;" />
</div>
```

**使用 currentColor 和相对值**：
```html
<div style="padding:12px; border-bottom:2px solid currentColor; opacity:0.8;">
  <a href="/link" style="opacity:0.85; text-decoration:none;">链接文字</a>
</div>
```

### ❌ 不推荐的写法

```html
<!-- 外部样式类无法生效 -->
<div class="my-custom-class">
  <img src="/image.png" class="my-image" />
</div>

<!-- 硬编码深色背景，在浅色模式下不协调 -->
<div style="background:#1f2937; color:#fff;">
  <p>这在浅色模式下会很突兀</p>
</div>
```

### 🎨 深色模式最佳实践

1. **背景色**：使用 `rgba()` 带透明度，如 `rgba(243,244,246,0.5)`
2. **文字颜色**：使用 `opacity` 控制透明度，而不是硬编码颜色
3. **边框**：使用 `rgba()` 或 `currentColor`
4. **链接**：依赖系统默认的链接颜色（会自动适配主题），或使用 `opacity`
5. **避免**：硬编码 `#fff` 或 `#000` 等绝对颜色

### 内置防御性样式

系统已自动提供以下保护，即使不写样式也能正常显示：

- ✅ 所有元素 `max-width: 100%`（防止溢出）
- ✅ 图片自动居中、自适应
- ✅ iframe 自动适配容器宽度
- ✅ 文字自动换行
- ✅ 链接默认蓝色，hover 下划线
- ✅ 自动适配深色/浅色模式

## 响应式设计

导航面板宽度：
- 移动端：256px
- 桌面端：300px

所有内容会自动适应面板宽度，建议：
- 图片宽度不超过 120px
- iframe 使用百分比宽度（`width: 100%`）

## 配置说明

### 热重载支持

Blog 配置支持热重载，修改 `config.json` 后**无需重启应用**，刷新文章页即可生效。

### 显示位置

自定义组件显示在文章页导航栏的 **分类列表下方**，与分类列表用分隔线隔开。

### 空配置处理

如果不配置或配置为空字符串，自定义组件区域将**不显示**，不会占用空间。

### 暗色模式适配

自定义组件会自动适配暗色/浅色主题：
- 分隔线颜色自动切换
- 链接颜色自动调整
- 建议在配置中也考虑暗色模式，使用中性色背景

**暗色模式友好的配置示例：**

```json
{
  "ArticleSidebarWidget": "<div style='text-align:center; padding:12px; background:rgba(243, 244, 246, 0.5); border-radius:8px;'><img src='/donate.png' style='width:100px;' /></div>"
}
```

## 安全性

- 自定义组件由管理员配置，仅在服务端配置文件中存储
- 前端通过 GraphQL API 获取后动态注入
- 内容在 Shadow DOM 中渲染，与文章内容隔离
- 建议只使用可信的内容和第三方服务

## 注意事项

1. **HTML 转义**：在 JSON 中配置时，确保正确转义双引号或使用单引号
2. **必须使用内联样式**：外部 CSS 类在 Shadow DOM 中无法生效
3. **图片路径**：使用相对路径（如 `/images/...`）或完整 URL
4. **脚本支持**：目前主要支持静态 HTML、图片、链接和 iframe
5. **内容长度**：建议保持简洁，避免内容过长影响用户体验

## 故障排除

### 问题：配置后没有显示

1. 检查 JSON 格式是否正确
2. 确认 `ArticleSidebarWidget` 字段拼写正确
3. 刷新文章页（不是首页）
4. 检查浏览器控制台是否有错误

### 问题：样式不生效

- 确保使用**内联样式**（`style="..."`）
- 不要使用外部 CSS 类

### 问题：图片不显示

- 检查图片路径是否正确

### 问题：内容溢出

- 检查是否设置了固定宽度（如 `width: 500px`）
- 改用百分比宽度或依赖默认的 `max-width: 100%`

## 完整配置示例

```json
{
  "Blog": {
    "BlogName": "我的技术博客",
    "Blogger": "张三",
    "Slogan": "分享技术，记录生活",
    "Domain": "https://example.com",
    "AnalyticsScript": "<script async src='...'></script>",
    "ArticleSidebarWidget": "<div style='text-align:center; padding:16px; background:#f9fafb; border-radius:8px;'><h4 style='font-size:14px; font-weight:600; margin:0 0 12px; color:#1f2937;'>❤️ 支持作者</h4><img src='/images/wechat-pay.png' style='width:100px; height:100px; border-radius:4px; margin:0 auto 8px;' /><p style='font-size:12px; color:#6b7280; margin:0;'>如果文章对你有帮助<br>欢迎扫码赞赏</p></div>"
  }
}
```

## 相关文档

- [网站统计脚本配置说明](网站统计脚本配置说明.md)
- [配置系统说明](配置系统说明.md)
