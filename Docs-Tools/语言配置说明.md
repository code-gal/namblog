# 语言配置说明

> 中文版本 | [English Version](Language-Configuration.md)

NamBlog 支持中英文双语界面，并支持博主创建自定义语言包。

## 国际化范围

NamBlog 的国际化覆盖以下内容：

### 前端界面
- ✅ 导航栏、按钮、表单标签
- ✅ 文章列表、分类、标签页面
- ✅ 登录界面和编辑器界面
- ✅ 提示消息、错误信息
- ✅ 通用操作文本（保存、取消、删除等）

### 后端响应
- ✅ API 错误消息和状态信息
- ✅ 验证错误提示
- ✅ 操作成功/失败反馈

### 目前不包含的内容
- ❌ 用户创建的文章内容（由博主自行管理）
- ❌ 开发日志和调试信息（保持英文）
- ❌ GraphQL Schema 描述（开发者工具）
- ❌ Prompt 和 MCP 描述（由AI使用）

## 默认行为（开箱即用）

**无需任何配置，系统会自动：**

1. 🌐 **自动检测浏览器语言**
   - 检测到中文浏览器 → 显示中文界面
   - 检测到其他语言 → 显示英文界面

2. 💾 **记住用户选择**
   - 用户切换语言后，选择会保存在浏览器 localStorage
   - 下次访问自动使用上次选择的语言

3. ✅ **无需配置文件**
   - 开箱即用，适合大多数场景
   - 需要强制指定语言时才需要配置

**默认优先级：**
1. localStorage 中的语言偏好（如果存在）
2. 浏览器语言自动检测
3. 英文（降级方案）

---

## 支持的语言

### 内置语言
- `zh-CN`: 简体中文
- `en-US`: 英文

### 自定义语言
博主可以创建任何语言的翻译文件，例如：
- `ja-JP`: 日语
- `fr-FR`: 法语
- `de-DE`: 德语
- 等等...

## 语言选择优先级

当配置了 `config.js` 后，系统按以下优先级确定使用的语言：

1. **config.js 中的 LANGUAGE** - 强制指定语言（最高优先级）
2. **config.js 中的 CUSTOM_LOCALE_CODE** - 自定义语言包
3. **localStorage.getItem('locale')** - 用户上次选择的语言
4. **浏览器语言检测** - `navigator.language`（自动检测）
5. **英文** - 默认降级方案

> 💡 **提示**：如果不配置 `config.js`，系统默认使用优先级 3 → 4 → 5

## 快速配置

### 方式一：直接修改 config.js

编辑 `NamBlog.Web/js/config.js` 文件顶部的配置区域：

```javascript
// ==================== 配置区域（生产环境可直接修改此部分） ====================

/**
 * 语言设置
 * - 'zh-CN': 中文
 * - 'en-US': 英文  
 * - null: 自动检测浏览器语言
 */
const LANGUAGE = 'zh-CN';  // 改为你需要的语言

/**
 * 自定义语言包URL（可选）
 */
const CUSTOM_LOCALE_URL = null;
const CUSTOM_LOCALE_CODE = null;

// ==================== 配置区域结束 ====================
```

### 方式二：Docker 映射 config.js（生产环境推荐）

1. 复制 `config.js` 到本地：
   ```bash
   cp NamBlog.Web/js/config.js /path/to/my-config.js
   ```

2. 修改配置：
   ```javascript
   const LANGUAGE = 'zh-CN';  // 你的语言
   ```

3. 使用 docker-compose.yml：
   ```yaml
   services:
     namblog:
       image: namblog
       volumes:
         - ./my-config.js:/app/wwwroot/js/config.js:ro
   ```

## 创建自定义语言包

### 步骤 1：创建语言文件

1. 复制现有语言文件作为模板：
   ```bash
   # 使用英文作为模板（推荐）
   cp NamBlog.Web/js/i18n/locales/en-US.js \
      NamBlog.Web/js/i18n/locales/ja-JP.js
   
   # 或使用中文作为模板
   cp NamBlog.Web/js/i18n/locales/zh-CN.js \
      NamBlog.Web/js/i18n/locales/ja-JP.js
   ```

2. 翻译所有文本（保持键名不变，只改值）：
   ```javascript
   export default {
       nav: {
           home: 'ホーム',        // 日语：首页
           categories: 'カテゴリ', // 日语：分类
           // ... 翻译其他键
       },
       // ...
   };
   ```

### 步骤 2：配置使用自定义语言

编辑 `config.js`：

```javascript
const LANGUAGE = null;  // 留空，使用自定义语言
const CUSTOM_LOCALE_URL = './js/i18n/locales/ja-JP.js';
const CUSTOM_LOCALE_CODE = 'ja-JP';
```

### 步骤 3：Docker 部署自定义语言

使用 docker-compose.yml：

```yaml
services:
  namblog:
    image: namblog
    volumes:
      - ./my-config.js:/app/wwwroot/js/config.js:ro
      - ./my-locales/ja-JP.js:/app/wwwroot/js/i18n/locales/ja-JP.js:ro
```

## 配置示例

### 示例 1：强制使用中文

```javascript
// config.js
const LANGUAGE = 'zh-CN';
const CUSTOM_LOCALE_URL = null;
const CUSTOM_LOCALE_CODE = null;
```

### 示例 2：强制使用英文

```javascript
// config.js
const LANGUAGE = 'en-US';
const CUSTOM_LOCALE_URL = null;
const CUSTOM_LOCALE_CODE = null;
```

### 示例 3：使用自定义日语

```javascript
// config.js
const LANGUAGE = null;  // 留空，使用自定义语言
const CUSTOM_LOCALE_URL = './js/i18n/locales/ja-JP.js';
const CUSTOM_LOCALE_CODE = 'ja-JP';
```

### 示例 4：自动检测浏览器语言

```javascript
// config.js
const LANGUAGE = null;  // 留空
const CUSTOM_LOCALE_URL = null;
const CUSTOM_LOCALE_CODE = null;
```

## 开发环境配置

开发环境仍使用 `config.local.js` 覆盖配置（不提交到 Git）：

1. 复制示例文件：
   ```bash
   cp config.local.example.js config.local.js
   ```

2. 编辑 `config.local.js`：
   ```javascript
   window.APP_CONFIG.DEV_MODE = true;
   window.APP_CONFIG.API_BASE_URL = 'http://localhost:5000';
   window.APP_CONFIG.LANGUAGE = 'en-US';  // 开发时测试英文
   ```

**注意**：生产环境不使用 `config.local.js`，避免混淆。

## 常见问题

### 1. 配置后没有生效？

- 清除浏览器缓存：`localStorage.clear()`
- 强制刷新：Ctrl+F5 或 Cmd+Shift+R
- 检查 config.js 语法
- 查看浏览器控制台错误

### 2. 自定义语言包加载失败？

检查：
- 文件路径是否正确
- 文件格式是否为 ES6 模块（export default）
- 文件编码是否为 UTF-8
- 查看控制台警告信息

### 3. Docker 部署后配置不生效？

```bash
# 检查容器内文件
docker exec -it <container> cat /app/wwwroot/js/config.js

# 检查语言文件
docker exec -it <container> cat /app/wwwroot/js/i18n/locales/ja-JP.js

# 查看容器日志
docker logs <container>
```

### 4. 如何切换回自动检测？

```javascript
const LANGUAGE = null;
const CUSTOM_LOCALE_URL = null;
const CUSTOM_LOCALE_CODE = null;
```

### 5. 能否同时支持多种语言？

当前版本每次只能使用一种语言。如需支持用户切换语言：
- 在导航栏添加语言切换按钮
- 调用 `setLocale('zh-CN')` 或 `setLocale('en-US')`
- 用户选择会保存在 localStorage

## 翻译文件结构

自定义语言文件必须包含以下所有节点（参考 `en-US.js` 或 `zh-CN.js`）：

```javascript
export default {
    nav: { ... },        // 导航栏（15个键）
    common: { ... },     // 通用文本（14个键）
    auth: { ... },       // 认证相关（13个键）
    article: { ... },    // 文章相关（约30个键）
    editor: { ... },     // 编辑器（约80个键）
    pagination: { ... }, // 分页（6个键）
    search: { ... },     // 搜索（3个键）
    errors: { ... }      // 错误消息（5个键）
};
```

**重要**：
- ✅ 保持所有键名不变，只翻译值
- ✅ `{count}`、`{page}` 等占位符保留原样
- ✅ 文件必须是有效的 JavaScript ES6 模块
- ✅ 确保文件编码为 UTF-8
- 📋 完整键列表请参考 `NamBlog.Web/js/i18n/locales/en-US.js`

## 生产环境最佳实践

### ✅ 推荐方案：映射 config.js

```yaml
# docker-compose.yml
services:
  namblog:
    image: namblog
    volumes:
      # 只需映射一个配置文件
      - ./production-config.js:/app/wwwroot/js/config.js
```

优点：
- 配置集中在一个文件
- 无需修改镜像
- 易于版本管理
- 避免开发/生产环境混淆
